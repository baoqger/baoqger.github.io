<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>Chris Bao&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Chris Bao&#39;s Blog">
<meta property="og:url" content="https://baoqger.github.io/page/6/index.html">
<meta property="og:site_name" content="Chris Bao&#39;s Blog">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Chris Bao">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Chris Bao&#39;s Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 5.2.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Chris Bao&#39;s Blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/about">About</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://baoqger.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-https-certificate-signature" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/03/05/https-certificate-signature/" class="article-date">
  <time datetime="2019-03-05T08:00:47.000Z" itemprop="datePublished">2019-03-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/03/05/https-certificate-signature/">How HTTPS works: part four - digital signature</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="Background"><a href="#Background" class="headerlink" title="Background"></a>Background</h3><p>The <a target="_blank" rel="noopener" href="https://organicprogrammer.com/2019/02/25/https-certificate/">second</a> article of this series shows that we should not directly exchange <code>public key</code> to establish a secure channel. Instead, <code>certificates</code> should be used to establish trust between clients and servers. And the last article examines the content of certificates, which encodes two very crucial pieces of information: <strong>the server’s public key</strong> and a <strong>digital signature</strong> that can confirm the certificate’s authenticity. In this article, let us examine what digital signature is and how it works.  </p>
<h3 id="Digital-Signature"><a href="#Digital-Signature" class="headerlink" title="Digital Signature"></a>Digital Signature</h3><p>The concept of <code>digital signature</code> can be illustrated as follows: </p>
<img src="/images/https-signature-process.png" title="digital signature process" width="600px" height="400px">

<p>When the server sends a message to the client, how can we prevent the attackers from eavesdropping on the message? The solution is that the server attaches its signature to the message, and the client accepts the message only if the verification of the certificate passes. So this process can be divided into two parts: <code>sign the message to get the digital signature</code> and <code>verify the digital signature</code>.</p>
<ul>
<li><p><strong>Sign the message</strong>: means <code>hash</code> the message and <code>encrypt</code> the hash with the server’s private key. The encrypted hash is called <code>digital signature</code>. </p>
</li>
<li><p><strong>Verify the signature</strong>: means <code>decrypt</code> the signature with the server’s public key to get the hash, <code>re-compute</code> the hash of the message again, and compare the identity of two hashes.</p>
</li>
</ul>
<p>What can we benefit from signing and verifying the digital signature? To verify the digital signature is to confirm two things: </p>
<ul>
<li><p><strong>Message Integrity</strong>: the message has not changed since the signature was attached because it is based on a  <code>cryptographic hash</code> of the message. </p>
</li>
<li><p><strong>Proof of Origin</strong>: the signature belongs to the person who alone has access to the private key. In this way, the recipient of the message can be sure of the origin of the message.</p>
</li>
</ul>
<p>Information security has other attributes, but integrity and authentication are the two traits you must know.</p>
<h3 id="Secrets-behind-digital-signature"><a href="#Secrets-behind-digital-signature" class="headerlink" title="Secrets behind digital signature"></a>Secrets behind digital signature</h3><p>As mentioned in the above section, the digital signature can prove the integrity of the message and the authenticity of the message’s owner. To understand how it works, you must understand the following two facts: </p>
<ul>
<li><strong>Hash is irreversible</strong></li>
</ul>
<p>In the previous articles, we explained that cryptography is a two-way algorithm. You can <code>encrypt</code> the plaintext to the ciphertext and <code>decrypt</code> the ciphertext back to the plaintext. It means the cryptographic algorithm is reversible. </p>
<p>Different from cryptographic algorithms, <strong>A hash is irreversible!</strong>. This irreversibility is the whole point.</p>
<p>The goal of any cryptographic hashing algorithm is to reduce the arbitrarily sized input into a fixed-sized hash. The cryptographic hashing algorithm should guarantee that no two different messages can produce an identical hash. That is <code>collide</code>. </p>
<p>In this way, it is impossible for attackers to reverse engineer such a <code>collision</code>. </p>
<img src="/images/https-signature-hash.png" title="Hash is irreversible" width="600px" height="400px">

<p>The attacker intercepts the message and changes it. Then the verification process of the signature on the client-side can not pass since the re-computed hashing can not match the original hashing. </p>
<p>I will write about how to implement a hash function in the future. In this article, you can ignore the details. Just remember that hashing is irreversible. </p>
<p><strong>The private key prove identity</strong></p>
<p>The attack shown above does not pass the verification because the signature and the forged message do not match. Then this time, the attacker compute a new hash based on the forged message and sign the hash with his private key. Can this attack work? </p>
<img src="/images/https-signature-key-identity.png" title="Hash is irreversible" width="800px" height="600px">

<p>The short answer is No. </p>
<p>When the client gets the digital signature, the first step is to <code>decrypt</code> it. The decryption breaks for this new attack because the forged signature is signed with the attacker’s private key instead of the server’s private key. </p>
<p><strong>It’s impossible for anybody except the owner of the private key to generate something that can be decrypted using the public key.</strong> This is the nature of public-key cryptography. I will write other articles to explain it mathematically in the future.  </p>
<p>In a word, the private key can prove identity.</p>
<h3 id="How-does-signature-make-certificate-secure"><a href="#How-does-signature-make-certificate-secure" class="headerlink" title="How does signature make certificate secure?"></a>How does signature make certificate secure?</h3><p>The digital signature is not designed only for TLS certificates, and it has other applications, which is not the focus of my article. The important thing is to understand how to apply digital signature in the PKI framework and how it makes certificates more secure. </p>
<p>The key is that <strong>the certificate associates the public key with the server you are connecting to</strong>. As we see in <a target="_blank" rel="noopener" href="https://organicprogrammer.com/2019/03/02/https-certificate-anatomy/">last</a> article, the certificate must contain some information about the identity of the server, such as the domain name of the server. For example, the <code>Subject</code> property of the <a target="_blank" rel="noopener" href="https://gist.github.com/baoqger/79923d4f92b166bb914aa700721d6a0b">certificate</a> we examined in the last article</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Subject: CN = *.google.com</span><br></pre></td></tr></table></figure>

<p>And the digital signature is <code>signed based on all of the information instead of only public key</code>. It can prevent man-in-the-middle attack in the two following cases:</p>
<ul>
<li><p>The attacker intercepts the server’s certificate and changes the public key or any other information, the hash code in the signature does not match the hash code of the content of the forged certificate, and the client rejects it. It is <code>Message Integrity</code> mentioned above. </p>
</li>
<li><p>The attacker can obtain a certificate signed by the trusted CA by pretending as a legitimate business. When the client requests a certificate from the server, the attacker can replace it with his own. The validation on the client-side can not pass. Although the attacker’s certificate is signed by a trusted CA, the domain name(or other server information) does not match the expected one. It is <code>Proof of Origin</code> mentioned above. </p>
</li>
</ul>
<p>So far, I hope you can understand (roughly) the beauty of this Internet security framework. </p>
<h3 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h3><p>In this article, I examined how a digital signature works. You see how to sign a signature and how to verify it. Digital signature and certificate are the most abstract part of the PKI framework. So in the following article, let me illustrate the whole process by manually going through the certificate verification process step by step. We will use <code>openssl</code> to examine the result in each step.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://baoqger.github.io/2019/03/05/https-certificate-signature/" data-id="cl4e085l8001iq8mm3mng6qck" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/digital-signature-hash-function/" rel="tag">digital signature, hash function</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-https-certificate-anatomy" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/03/02/https-certificate-anatomy/" class="article-date">
  <time datetime="2019-03-02T08:00:47.000Z" itemprop="datePublished">2019-03-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/03/02/https-certificate-anatomy/">How HTTPS works: part three - the anatomy of certificate</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="Background"><a href="#Background" class="headerlink" title="Background"></a>Background</h3><p>In the <a target="_blank" rel="noopener" href="https://organicprogrammer.com/2019/02/25/https-certificate/">last article</a>, we examined the importance of certificates, which prevent us from the man-in-the-middle attacks. But we did not explain the mechanics of certificates, and it will be the focus of the following articles. In this article, let us first examine how the <code>TLS certificate</code> looks like and what kind of information it contains? </p>
<h3 id="Anatomy-of-certificate"><a href="#Anatomy-of-certificate" class="headerlink" title="Anatomy of certificate"></a>Anatomy of certificate</h3><p>The official name of <code>SSL/TLS certificate</code> is <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/X.509"><code>X.509 certificate</code></a>. Before we can examine the content of the certificate, we must get it. We can do this with <code>openssl</code>. <code>openssl</code> is a popular tool in the network security field. In the following articles, we will use it a lot. For the use of <code>openssl</code>, you can refer to this online <a target="_blank" rel="noopener" href="https://www.feistyduck.com/books/openssl-cookbook/">document</a>. </p>
<p>Let us pull the certificate from google.com domain as follows: </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl s_client -showcerts -connect google.com:443</span><br></pre></td></tr></table></figure>
<p>The output contains a large amount of information, and I omit some unnecessary codes to make it compact as follows: </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">CONNECTED(00000003)</span><br><span class="line">depth=2 C = US, O = Google Trust Services LLC, CN = GTS Root R1</span><br><span class="line">verify return:1</span><br><span class="line">depth=1 C = US, O = Google Trust Services LLC, CN = GTS CA 1C3</span><br><span class="line">verify return:1</span><br><span class="line">depth=0 CN = *.google.com</span><br><span class="line">verify return:1</span><br><span class="line">---</span><br><span class="line">Certificate chain</span><br><span class="line"> 0 s:CN = *.google.com</span><br><span class="line">   i:C = US, O = Google Trust Services LLC, CN = GTS CA 1C3</span><br><span class="line">-----BEGIN CERTIFICATE-----</span><br><span class="line">MIINsjCCDJqgAwIBAgIRAPq8ife/MxCUCgAAAAEl/TIwDQYJKoZIhvcNAQELBQAw</span><br><span class="line">FYN5klRqI0hWa3wYe6tnXm/2PvPbAwqsnAq3q+Iek+3pGm6YTshJyA7P9L176psd</span><br><span class="line">&lt;... content omitted ...&gt;</span><br><span class="line">dm6slAYpHOryFcrvXzu1lHSylCAFNT/OYcH1GLTf0qJXuN7YnX9swoYu2oCDkIyA</span><br><span class="line">Hss2DDp7f8qf0VgDNNxZB8drZ9ID85YA3qgeIbHHAB8UIj8qkKXkmybfMxVL0lz3</span><br><span class="line">iY73asSm</span><br><span class="line">-----END CERTIFICATE-----</span><br><span class="line"> 1 s:C = US, O = Google Trust Services LLC, CN = GTS CA 1C3</span><br><span class="line">   i:C = US, O = Google Trust Services LLC, CN = GTS Root R1</span><br><span class="line">-----BEGIN CERTIFICATE-----</span><br><span class="line">MIIFljCCA36gAwIBAgINAgO8U1lrNMcY9QFQZjANBgkqhkiG9w0BAQsFADBHMQsw</span><br><span class="line">CQYDVQQGEwJVUzEiMCAGA1UEChMZR29vZ2xlIFRydXN0IFNlcnZpY2VzIExMQzEU</span><br><span class="line">&lt;... content omitted ...&gt;</span><br><span class="line">AJ2xDx8hcFH1mt0G/FX0Kw4zd8NLQsLxdxP8c4CU6x+7Nz/OAipmsHMdMqUybDKw</span><br><span class="line">juDEI/9bfU1lcKwrmz3O2+BtjjKAvpafkmO8l7tdufThcV4q5O8DIrGKZTqPwJNl</span><br><span class="line">1IXNDw9bg1kWRxYtnCQ6yICmJhSFm/Y3m6xv+cXDBlHz4n/FsRC6UfTd</span><br><span class="line">-----END CERTIFICATE-----</span><br><span class="line"> 2 s:C = US, O = Google Trust Services LLC, CN = GTS Root R1</span><br><span class="line">   i:C = BE, O = GlobalSign nv-sa, OU = Root CA, CN = GlobalSign Root CA</span><br><span class="line">-----BEGIN CERTIFICATE-----</span><br><span class="line">MIIFYjCCBEqgAwIBAgIQd70NbNs2+RrqIQ/E8FjTDTANBgkqhkiG9w0BAQsFADBX</span><br><span class="line">MQswCQYDVQQGEwJCRTEZMBcGA1UEChMQR2xvYmFsU2lnbiBudi1zYTEQMA4GA1UE</span><br><span class="line">&lt;... content omitted ...&gt;</span><br><span class="line">9U5pCZEt4Wi4wStz6dTZ/CLANx8LZh1J7QJVj2fhMtfTJr9w4z30Z209fOU0iOMy</span><br><span class="line">+qduBmpvvYuR7hZL6Dupszfnw0Skfths18dG9ZKb59UhvmaSGZRVbNQpsg3BZlvi</span><br><span class="line">d0lIKO2d1xozclOzgjXPYovJJIultzkMu34qQb9Sz/yilrbCgj8=</span><br><span class="line">-----END CERTIFICATE-----</span><br><span class="line">---</span><br><span class="line">Server certificate</span><br><span class="line">subject=CN = *.google.com</span><br><span class="line"></span><br><span class="line">issuer=C = US, O = Google Trust Services LLC, CN = GTS CA 1C3</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">&lt;... content omitted ...&gt;</span><br></pre></td></tr></table></figure>

<p>Note: if you want to take a look at the full content of the above output, please refer to this online <a target="_blank" rel="noopener" href="https://gist.github.com/baoqger/d1d5792d17c4b260ca186d9d2651066b">gist file</a></p>
<p>Based on the format of the output, you can figure out that the content between <code>-----BEGIN CERTIFICATE-----</code> and <code>-----END CERTIFICATE-----</code> markers is a certificate. </p>
<p>Another remarkable point is that the server returns not one, but three certificates. These associated certificates form a <code>certificate chain</code>. I will examine it in future articles. In the current post, let us focus on the certificate itself. </p>
<p>As shown above, the default format of the certificate is <code>PEM(Privacy Enhanced Mail)</code>. PEM is a Base64 encoded binary format. We can convert it to a human-readable format with <code>openssl</code>.</p>
<p>First, let us extract the google.com server certificate into a file named <strong>google_com.pem</strong>. Remember to include the <code>BEGIN</code> and <code>END</code> markers, but nothing more. You can refer to this <a target="_blank" rel="noopener" href="https://gist.github.com/baoqger/8c854336118737db2cb55997ca7888c9">file</a>.</p>
<p>Then, run the following openssl command: </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl x509 -in google_com.pem -noout -text</span><br></pre></td></tr></table></figure>
<p>here is the <a target="_blank" rel="noopener" href="https://gist.github.com/baoqger/79923d4f92b166bb914aa700721d6a0b">output</a> (with some content omitted):</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">Certificate:</span><br><span class="line">    Data:</span><br><span class="line">        Version: 3 (0x2)</span><br><span class="line">        Serial Number:</span><br><span class="line">            fa:bc:89:f7:bf:33:10:94:0a:00:00:00:01:25:fd:32</span><br><span class="line">        Signature Algorithm: sha256WithRSAEncryption</span><br><span class="line">        Issuer: C = US, O = Google Trust Services LLC, CN = GTS CA 1C3</span><br><span class="line">        Validity</span><br><span class="line">            Not Before: Nov 29 02:22:33 2021 GMT</span><br><span class="line">            Not After : Feb 21 02:22:32 2022 GMT</span><br><span class="line">        Subject: CN = *.google.com</span><br><span class="line">        Subject Public Key Info:</span><br><span class="line">            Public Key Algorithm: id-ecPublicKey</span><br><span class="line">                Public-Key: (256 bit)</span><br><span class="line">                pub:</span><br><span class="line">                    04:a1:c2:d2:74:cc:32:68:86:68:18:0c:8f:5a:e1:</span><br><span class="line">                    &lt;... content omitted ...&gt;</span><br><span class="line">                    c8:1b:6b:85:5d</span><br><span class="line">                ASN1 OID: prime256v1</span><br><span class="line">                NIST CURVE: P-256</span><br><span class="line">        X509v3 extensions:</span><br><span class="line">            X509v3 Key Usage: critical</span><br><span class="line">                Digital Signature</span><br><span class="line">            X509v3 Extended Key Usage:</span><br><span class="line">                TLS Web Server Authentication</span><br><span class="line">            X509v3 Basic Constraints: critical</span><br><span class="line">                CA:FALSE</span><br><span class="line">            X509v3 Subject Key Identifier:</span><br><span class="line">                04:0E:70:9D:60:11:97:01:1B:0E:7E:72:B1:99:E5:28:F7:29:E0:72</span><br><span class="line">            X509v3 Authority Key Identifier:</span><br><span class="line">                keyid:8A:74:7F:AF:85:CD:EE:95:CD:3D:9C:D0:E2:46:14:F3:71:35:1D:27</span><br><span class="line"></span><br><span class="line">            Authority Information Access:</span><br><span class="line">                OCSP - URI:http://ocsp.pki.goog/gts1c3</span><br><span class="line">                CA Issuers - URI:http://pki.goog/repo/certs/gts1c3.der</span><br><span class="line"></span><br><span class="line">            X509v3 Subject Alternative Name:</span><br><span class="line">                DNS:*.google.com, DNS:*.appengine.google.com, DNS:*.bdn.dev, DNS:*.cloud.google.com, DNS:*.crowdsource.google.com, DNS:*.datacompute.google.com, DNS:*.google.ca, DNS:*.</span><br><span class="line">                &lt;... content omitted ...&gt;</span><br><span class="line">                youtubekids.com, DNS:yt.be, DNS:*.yt.be, DNS:android.clients.google.com, DNS:developer.android.google.cn, DNS:developers.android.google.cn, DNS:source.android.google.cn</span><br><span class="line">            X509v3 Certificate Policies:</span><br><span class="line">                Policy: 2.23.140.1.2.1</span><br><span class="line">                Policy: 1.3.6.1.4.1.11129.2.5.3</span><br><span class="line"></span><br><span class="line">            X509v3 CRL Distribution Points:</span><br><span class="line"></span><br><span class="line">                Full Name:</span><br><span class="line">                  URI:http://crls.pki.goog/gts1c3/QqFxbi9M48c.crl</span><br><span class="line"></span><br><span class="line">            CT Precertificate SCTs:</span><br><span class="line">                Signed Certificate Timestamp:</span><br><span class="line">                    Version   : v1 (0x0)</span><br><span class="line">                    Log ID    : 29:79:BE:F0:9E:39:39:21:F0:56:73:9F:63:A5:77:E5:</span><br><span class="line">                                BE:57:7D:9C:60:0A:F8:F9:4D:5D:26:5C:25:5D:C7:84</span><br><span class="line">                    Timestamp : Nov 29 03:22:38.708 2021 GMT</span><br><span class="line">                    Extensions: none</span><br><span class="line">                    Signature : ecdsa-with-SHA256</span><br><span class="line">                                30:46:02:21:00:B5:C7:D9:40:A7:62:19:B6:D8:62:D2:</span><br><span class="line">                                &lt;... content omitted ...&gt;</span><br><span class="line">                                F9:53:FA:C7:EF:2C:BA:9C</span><br><span class="line">                Signed Certificate Timestamp:</span><br><span class="line">                    Version   : v1 (0x0)</span><br><span class="line">                    Log ID    : 41:C8:CA:B1:DF:22:46:4A:10:C6:A1:3A:09:42:87:5E:</span><br><span class="line">                                4E:31:8B:1B:03:EB:EB:4B:C7:68:F0:90:62:96:06:F6</span><br><span class="line">                    Timestamp : Nov 29 03:22:38.872 2021 GMT</span><br><span class="line">                    Extensions: none</span><br><span class="line">                    Signature : ecdsa-with-SHA256</span><br><span class="line">                                30:45:02:21:00:87:35:02:A8:F6:06:EF:BC:F4:C1:95:</span><br><span class="line">                                &lt;... content omitted ...&gt;</span><br><span class="line">                                7E:5B:8B:35:E6:D2:3C</span><br><span class="line">    Signature Algorithm: sha256WithRSAEncryption</span><br><span class="line">         76:6a:8a:d8:44:ac:14:40:92:36:f3:4a:b5:cb:54:36:67:c7:</span><br><span class="line">         3a:a5:e9:b5:31:6c:51:5f:f3:ed:6a:99:ac:a7:5b:9c:ae:c9:</span><br><span class="line">         &lt;... content omitted ...&gt;</span><br><span class="line">         59:07:c7:6b:67:d2:03:f3:96:00:de:a8:1e:21:b1:c7:00:1f:</span><br><span class="line">         14:22:3f:2a:90:a5:e4:9b:26:df:33:15:4b:d2:5c:f7:89:8e:</span><br><span class="line">         f7:6a:c4:a6</span><br></pre></td></tr></table></figure>
<p>The certificate contains many elements. They are specified using a syntax<br>referred to as <code>ASN.1(Abstract Syntax Notation)</code>. As you can see, the certificate consists of two parts: <strong>Data</strong> and <strong>Signature Algorithm</strong>. The <strong>Data</strong> part contains the identity information about this server certificate. And the second part is the <code>digital signature</code> of this certificate. I’ll highlight the following elements:</p>
<ul>
<li><strong>Issuer</strong>: identifies who issues this certificate, also known as CA(certificate authority).</li>
<li><strong>Subject</strong>: identifies to whom the certificate is issued. In the case of the server certificate, the <code>Subject</code> should be the organization that owns the server. But in the certificate chain, the <code>Issuer</code> of the server certificate is the <code>Subject</code> of the intermediate certificate. I’ll examine this relationship in detail in the following article. </li>
<li><strong>Subject Public Key Info</strong>: the server’s public key. As we mentioned above, we created the certificate just to send the public key to the client. </li>
<li><strong>Signature Algorithm</strong>: refers to the element at the bottom of the certificate. The <strong>sha256WithRSAEncryption</strong> part denotes the <code>hash function</code> and <code>encryption algorithm</code> used to <code>sign the certificate</code>. In the above case, the server uses <code>sha256</code> as the hash function and <code>RSA</code> as the encryption algorithm. And the following block contains the signed hash of X.509 certificate data, called <code>digital signature</code>. The digital signature is the key information in certificates to establish trust between clients and servers. I’ll explain how a digital certificate works in the next article. </li>
</ul>
<h3 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h3><p>This article examines the information contained inside certificates using the tool <code>openssl</code>. We highlight some critical elements, and in the following article let us take a deep look at <code>digital signature</code>.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://baoqger.github.io/2019/03/02/https-certificate-anatomy/" data-id="cl4e085l6001eq8mmhs9gea5y" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/certificate-digital-signature-hashing/" rel="tag">certificate, digital signature, hashing</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-https-certificate" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/02/25/https-certificate/" class="article-date">
  <time datetime="2019-02-25T08:00:47.000Z" itemprop="datePublished">2019-02-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/02/25/https-certificate/">How HTTPS works: part two - why we need public key and certificate</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="Background"><a href="#Background" class="headerlink" title="Background"></a>Background</h3><p>In the first article of this series, I gave a high-level overview of <code>TLS handshake</code>. It covers many complex concepts like <code>encryption/decryption</code> <code>hash function</code> <code>public key</code> <code>private key</code>  and <code>digital certificate</code>. These concepts are defined in the framework of <code>Public Key Infrastructure (PKI)</code>.</p>
<p>Let’ continue exploring the PKI. This article focuses on understanding the <code>certificates</code> used to establish trust between clients and servers.  </p>
<h3 id="Symmetric-plus-Asymmetric"><a href="#Symmetric-plus-Asymmetric" class="headerlink" title="Symmetric plus Asymmetric"></a>Symmetric plus Asymmetric</h3><p><a target="_blank" rel="noopener" href="https://organicprogrammer.com/2019/02/22/https-handshake/">Last post</a> examined the <code>TLS handshake</code>. What is remarkable in this process is both <code>symmetric encryption</code> and <code>asymmetric encryption</code> are used. </p>
<p><code>symmetric encryption</code> and <code>asymmetric encryption</code> are the two broad categories of cryptographic algorithms. </p>
<p>Symmetric key encryption uses the same key on both sides of the communication channel to encrypt or decrypt data. In <code>HTTPS</code> case, the client and server agree upon new keys to use for symmetric encryption, called <strong>session key</strong>. The HTTP messages are encrypted by this symmetric session key. </p>
<p>It has the advantage of being very fast with low overhead. In this way, it can minimize the performance impact <code>TLS</code> will have on the network communications. </p>
<p>But the real challenge of symmetric encryption is <strong>how to keep the key private and secure!</strong> The client and server must exchange keys without letting an interested eavesdropper see them. This seems like a <strong>chicken and egg problem</strong>; you can’t establish keys over an insecure channel, and you can’t establish a secure channel without keys. Right? </p>
<p>This key management turns out to be the most difficult part of encryption operations and is where asymmetric or public-key cryptography enters. </p>
<p>Simply speaking, <strong>a secure channel is firstly established with asymmetric cryptography and then the symmetric session key is exchanged through this secure channel</strong>. </p>
<p><strong>Note</strong>: Cryptography is a complex topic, which isn’t in the scope of this series of articles. You can find <a target="_blank" rel="noopener" href="https://opensource.com/article/19/6/cryptography-basics-openssl-part-2">tons</a> of documents on the internet about it for deeper understanding. You can regard it as a block box and ignore the details. This doesn’t influence your understanding of <code>HTTPS</code> in high level </p>
<h3 id="Why-do-we-need-certificates"><a href="#Why-do-we-need-certificates" class="headerlink" title="Why do we need certificates"></a>Why do we need certificates</h3><p>Now we know public-key cryptography is needed to establish a secure channel. Can we directly transmit the public key from servers to clients? Why do we need a certificate as the carrier to pass the public key? Can we exchange the public key without certificates as follows: </p>
<img src="/images/https_wo_certificate.png" title="public key without certificate" width="600px" height="400px">

<p>But the ultimate question is how you(as the client) know that the public key can be trusted as authentic? Assume that an attacker can not only view traffic, but also can intercept and modify it. Then the attacker can carry out <code>man-in-the-middle</code> attack as follows:  </p>
<img src="/images/https_mitm.png" title="man in the middle attack" width="800px" height="600px">

<p>The attacker can replace the server’s public key with its own and send it to the client. The client doesn’t feel anything wrong and keeps using this public key as normal. The client encrypts the session key with the forged public key(the one from attackers) and sends it out. The attacker decrypts the session key with its private key, re-encrypt the session key with the server’s public key, and sends it to the server. As normal, the server decrypts the session key and agrees on it. But this session key is in the attacker’s hand too. The attacker can decrypt all the subsequent network traffic. </p>
<p>The problem here is that the client blindly <strong>trusts</strong> that the public key belongs to the server. That’s the reason why we need the <code>certificates</code> to establish trust between clients and servers.</p>
<h3 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h3><p>In this article, we understand the importance of public-key cryptography and certificates. In the next article, we will take a deep look at the certificate.  </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://baoqger.github.io/2019/02/25/https-certificate/" data-id="cl4e085l8001kq8mmb82i01as" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/public-key-man-in-the-middle-certificate/" rel="tag">public key, man-in-the-middle, certificate</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-https-handshake" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/02/22/https-handshake/" class="article-date">
  <time datetime="2019-02-22T03:04:58.000Z" itemprop="datePublished">2019-02-22</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/02/22/https-handshake/">How HTTPS works: part one - TLS handshake</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="Background"><a href="#Background" class="headerlink" title="Background"></a>Background</h3><p>At present, everybody knows about the lock icon in the browser’s address bar indicating that the session is protected by <code>HTTPS</code>.In this series of articles, I’ll show you how HTTPS works based on my research. </p>
<p>Simply speaking, <code>HTTPS = HTTP + SSL/TLS</code>. </p>
<p>In the <code>HTTP</code> protocol, the client communicates with the server by transmitting the message over the network. But the message is in the original format known as plaintext. The bad guys (attackers) can easily eavesdrop on the message. That’s the reason why we need <code>SSL/TLS</code>. </p>
<p>There are tons of <a target="_blank" rel="noopener" href="https://www.globalsign.com/en/blog/ssl-vs-tls-difference">articles</a> online describing the relationship between SSL and TLS. You can regard TLS as the modern and advanced version of SSL. By conversion, we generally put them together as the name of the network security protocol. </p>
<p>In the <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/OSI_model">OSI model</a>, the <code>HTTP</code> protocol is in <strong>layer 7</strong>, which is at the top of protocol stacks, how about <code>TLS</code> protocol. Although <code>TLS</code> is short for <code>Transport Layer Security</code>, it’s not in <strong>layer 4(transport layer)</strong>. You can roughly regard it as <strong>layer 5(session layer)</strong>. </p>
<p>This means there is no nontrivial difference between <code>HTTP</code> and <code>HTTPS</code> in terms of message transmission. This series of articles will focus on the security part of <code>HTTPS</code>. If you want to understand HTTP itself, please read my other <a href="https://baoqger.github.io/2021/12/01/understand-http-1-1-client-golang/">articles</a>. </p>
<p>As the first article of this series, I will talk about how to establish an <code>HTTPS</code> connection. This introduces a new concept: <strong>TLS handshake</strong>.</p>
<h3 id="TLS-Handshake"><a href="#TLS-Handshake" class="headerlink" title="TLS Handshake"></a>TLS Handshake</h3><p>In my previous article, I wrote about <a href="https://baoqger.github.io/2019/07/14/why-tcp-four-way-handshake/"><code>TCP three way handshake</code></a> to establish a TCP connection. For <code>HTTP</code> protocol, that’s all it needs to do. But <code>HTTPS</code> has to do <code>TLS handshake</code> as well. The process can be illustrated as follows: </p>
<p><strong>Note</strong> TLS handshakes occur after a TCP connection has been opened via a TCP handshake.</p>
<img src="/images/https-tls-handshake.png" title="tls handshake" width="600px" height="400px">

<p><strong>Note</strong> to understand each detail of the above processing, you need to have some prerequisite knowledge such as <code>encryption/decryption</code>, <code>hash function</code>, <code>public key</code>, <code>private key</code>, and <code>digital certificate</code>.  If you don’t know, don’t worry. After reading this series of articles, you’ll have it under your belt. In this article, I’ll go through this process roughly and ignore the detail of each step. </p>
<ul>
<li><p><strong>Client hello message</strong>: the client starts the handshake by sending a “hello” message to the server. This “hello” message includes the TLS version and the <code>cipher suites</code> supported on the client-side. <code>cipher suites</code> is a fancy name for the set of encryption algorithms for use in establishing a secure connection.</p>
</li>
<li><p><strong>Server hello message</strong>: the server chooses the best(or suitable) SSL/TLS version and encryption algorithm among the candidates sent by the client. The server’s chosen cipher suite and <code>certificate</code> are sent to the client. <code>certificate</code> makes SSL/TLS encryption possible, which is critical to understand the entire process. For now, you need to know certificates contain the server’s <code>public key</code>  which is sent to the client. And the <code>private key</code> is kept secret on the server. </p>
</li>
<li><p><strong>Authentication</strong>: The client verifies the server’s certificate (I’ll investigate the certificate verification process at a very detailed level in another article). </p>
</li>
<li><p><strong>Encrypt the pre-master key</strong>: The client generates one random “pre-master” key, encrypts “pre-master” key with the server’s public key (extract from the certificate) and sends the encrypted “pre-master” key to the server.</p>
</li>
<li><p><strong>Decrypt the pre-master key</strong>: The server decrypts the “pre-master” key with its private key (The premaster key is encrypted with the public key and can only be decrypted with the private key by the server. This is called <code>asymmetric encryption</code>).</p>
</li>
<li><p><strong>Session key created</strong>: Both client and server will generate a <code>session key</code> based on the “pre-master” key. The <code>session key</code> should be the same on both sides.</p>
</li>
<li><p><strong>HTTP message encryption</strong>: Until the last step, the handshake is completed. The client and server will use the agreed <code>session key</code> to encrypt the following HTTP messages and continue the communication (since both sides use the same key, this is called <code>symmetric encryption</code>). </p>
</li>
</ul>
<p>That’s all about <code>TLS handshake</code> process. </p>
<h3 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h3><p>As the first article of this series, I go through the entire process of TLS handshake. In future articles, I’ll show you the mysteries of each part. </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://baoqger.github.io/2019/02/22/https-handshake/" data-id="cl4e085l9001mq8mm18xxdrrx" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/HTTPS-TLS-handshake-SSL-TLS/" rel="tag">HTTPS, TLS handshake, SSL/TLS</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-why-tcp-four-way-handshake" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/12/14/why-tcp-four-way-handshake/" class="article-date">
  <time datetime="2018-12-14T08:34:58.000Z" itemprop="datePublished">2018-12-14</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/12/14/why-tcp-four-way-handshake/">Why TCP connection termination needs four-way handshake</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="Background"><a href="#Background" class="headerlink" title="Background"></a>Background</h3><p>In <code>TCP/IP</code> protocol stack, the <code>three way handshake</code> for connection establishment and <code>four way handshake</code> for connection termination are some concepts you must understand.</p>
<p>But after I learned <code>TCP/IP</code> stack, one question coming to my mind is why the connection termination needs four-way handshake. In this article, I will focus on this topic. To understand the answer to this question, we need to first explain the details of these two processes and compare them to find the difference. </p>
<h3 id="TCP-connection-establishment"><a href="#TCP-connection-establishment" class="headerlink" title="TCP connection establishment"></a>TCP connection establishment</h3><p>In contrast to <code>UDP</code>, TCP is a <code>connection-oriented</code> and <code>reliable full duplex</code> protocol, which requires a logical connection to be established between the two processes before data is exchanged. The connection must be maintained during the entire process that communication is taking place. And in TCP both sides can send data to its peer. </p>
<p>So four things need to happen for fully establishing a TCP connection:</p>
<ul>
<li>Each node has send a <code>SYN</code> flag to its peer (that’s two things, one <code>SYN</code> in each direction)</li>
<li>Each node has received a <code>ACK</code> flag of its own <code>SYN</code> flag from its peer  (that’s two things) </li>
</ul>
<p>Both <code>SYN</code> and <code>ACK</code> are properties in <code>TCP</code> header, where <code>SYN</code> means <code>synchronization</code> and <code>ACK</code> means <code>acknowledgement</code>. In detail the process goes as follows:</p>
<p>Firstly, the client sends the <code>SYN: 1</code> packet to server to start the connection. When the server receives the packet, it will send the <code>ACK: 1</code> packet to client to confirm that. Since in the TCP protocol, the server can also send data to the client. So the server needs to send the <code>SYN: 1</code> packet to the client as well. Finally, when the client sends the <code>ACK: 1</code> packet to the server. The establishment process is done, which goes as follows: </p>
<img src="/images/tcp-establishment-4-packets.png" title="tcp establishment with four packets" width="600px" height="400px">

<p>Note that the server sends two packets: <code>ACK: 1</code> and <code>SYN: 1</code> in sequence. Why not combine these two packets into one to have a better network performance? So the common implementation of TCP protocol  goes as follows:</p>
<img src="/images/tcp-establishment-3-packets.png" title="tcp establishment with three packets" width="600px" height="400px">

<p><strong>Note</strong>: besides <code>SYN</code> and <code>ACK</code> flag, in the establishment stage there are other fields need to be set in TCP header such as: <code>sequence number</code> and <code>window</code>. I will discuss these important TCP header fields in other articles.</p>
<h3 id="TCP-connection-termination"><a href="#TCP-connection-termination" class="headerlink" title="TCP connection termination"></a>TCP connection termination</h3><p>When the data stream transportation (I will not cover this part in this article) is over, we need to terminate the TCP connection. </p>
<p>Same as above, four things need to happen for fully terminating a TCP connection:</p>
<ul>
<li>Each node has send a <code>FIN</code> flag to its peer (that’s two things, one <code>FIN</code> in each direction)</li>
<li>Each node has received a <code>ACK</code> flag of its own <code>FIN</code> flag from its peer  (that’s two things) </li>
</ul>
<img src="/images/tcp_termination.png" title="tcp termination" width="600px" height="400px">

<p>But the difference is that in most TCP implementation, four packets are used to terminate the connection. We didn’t combine the <code>ACK: 1</code> packet (marked as ②) and the <code>FIN: 1</code> packet (marked as ③) into one packet. </p>
<p>The reason is <code>ACK: 1</code> packet (marked as ②) is send by TCP stack automatically. And the next <code>FIN: 1</code> packet (marked as ③) is controlled in application level by calling <code>close</code> socket API. Application has the control to terminate the connection. So in common case, we didn’t merge this two packets into one. </p>
<p>It’s flexible for the application to control this process, for example, in this way the application can reuse existing TCP connection to reduce the overhead and improve the performance. In next article, I will talk about this topic.  </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://baoqger.github.io/2018/12/14/why-tcp-four-way-handshake/" data-id="cl4e085lk002mq8mmes0ogius" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/TCP-IP/" rel="tag">TCP, IP</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-array-pointer-similarities-c" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/11/12/array-pointer-similarities-c/" class="article-date">
  <time datetime="2018-11-12T07:25:32.000Z" itemprop="datePublished">2018-11-12</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/11/12/array-pointer-similarities-c/">array-pointer-similaries-c</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
      
    </div>
    <footer class="article-footer">
      <a data-url="https://baoqger.github.io/2018/11/12/array-pointer-similarities-c/" data-id="cl4e085ko0004q8mm5zj0hodu" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/programming-c-array-pointer/" rel="tag">programming c, array, pointer</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-why-build-heap-is-a-linear-operation" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/10/08/why-build-heap-is-a-linear-operation/" class="article-date">
  <time datetime="2018-10-07T23:43:52.000Z" itemprop="datePublished">2018-10-08</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/10/08/why-build-heap-is-a-linear-operation/">How to build a Heap in linear time complexity</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="Background"><a href="#Background" class="headerlink" title="Background"></a>Background</h3><p>In this article, I will focus on the topic of <code>data structure and algorithms</code> (in my eyes, one of the most important skills for software engineers). Someday I came across one <a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/9755721/how-can-building-a-heap-be-on-time-complexity">question</a> goes like this: <em>how can building a heap be O(n) time complexity?</em> This question confuses me for a while, so I did some investigation and research on it. This article will share what I learned during this process, which covers the following points:</p>
<ul>
<li>What is a heap data structure? How does a heap behave? </li>
<li>How to implement a completed heap in C programming?</li>
<li>How to do the time complexity analysis on building the heap?</li>
</ul>
<h3 id="Basics-of-Heap"><a href="#Basics-of-Heap" class="headerlink" title="Basics of Heap"></a>Basics of Heap</h3><p>Before we dive into the implementation and time complexity analysis, let’s first understand the <code>heap</code>. </p>
<p>As a data structure, the <code>heap</code> was created for the heapsort sorting algorithm long ago. Besides heapsort, <code>heaps</code> are used in many famous algorithms such as <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Dijkstra%27s_algorithm">Dijkstra’s algorithm</a> for finding the shortest path. Essentially, <em>heaps are the data structure you want to use when you want to be able to access the maximum or minimum element very quickly.</em></p>
<p>In computer science, a <code>heap</code> is a <em>specialized tree-based</em> data structure. A common implementation of a <code>heap</code> is the <em>binary heap</em>, in which the tree is a <em>binary tree</em>. </p>
<p>So a <code>heap</code> can be defined as a binary tree, but with two additional properties (that’s why we said it is a specialized tree):</p>
<ul>
<li><p><strong>shape property</strong>: a binary heap is a <em>complete</em> binary tree. So what is a <em>complete</em> binary tree? That is all levels of the tree, except possibly the last one(deepest) are fully filled, and, if the last level of the tree is not complete, the nodes of that level are filled from left to right. The complete binary tree is one type of binary tree, in detail,  you can refer to this <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Binary_tree#Types_of_binary_trees">document</a> to learn more about it.</p>
</li>
<li><p><strong>Heap property</strong>: the key stored in each node is either greater than or equal to (max-heaps) or less than or equal to (min-heaps) the keys in the node’s children. </p>
</li>
</ul>
<p>The following image shows a binary max-heap based on tree representation: </p>
<img src="/images/heap.png" title="heap" width="400px" height="300px">

<p>The <code>heap</code> is a powerful data structure; because you can insert an element and extract(remove) the smallest or largest element from a min-heap or max-heap with only <strong>O(log N)</strong> time. That’s why we said that if you want to access to the maximum or minimum element very quickly, you should turn to <code>heaps</code>. In the next section, I will examine how heaps work by implementing one in C programming. </p>
<p>Note: The heap is closely related to another data structure called the <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Priority_queue"><code>priority queue</code></a>.  The <code>priority queue</code> can be implemented in various ways, but the <code>heap</code> is one maximally efficient implementation and in fact, priority queues are often referred as “heaps”, regardless of how they may be implemented. </p>
<h3 id="Implementation-of-Heap"><a href="#Implementation-of-Heap" class="headerlink" title="Implementation of Heap"></a>Implementation of Heap</h3><p>Because of the <code>shape property</code> of heaps, we usually implement it as an array, as follows:</p>
<ul>
<li>Each element in the array represents a node of the heap.</li>
<li>The parent/child relationship can be defined by the elements’ indices in the array. Given a node at index <code>i</code>, the left child is at index <code>2*i + 1</code> and the right child is at index <code>2*i + 2</code>, and its parent is at index <code>⌊(i-1)/2⌋</code> (<code>⌊⌋</code> means Floor operation). </li>
</ul>
<img src="/images/array-representation.png" title="heap" width="400px" height="300px">

<p>Based on the above model, let’s start implementing our heap. As we mentioned, there are two types of heaps: min-heap and max-heap, in this article, I will work on <code>max-heap</code>. The difference between max-heap and min-heap is trivial, you can try to write out the min-heap after you understand this article. </p>
<p>The completed code implementation is inside this Github <a target="_blank" rel="noopener" href="https://github.com/baoqger/max-heap-in-c">repo</a>. </p>
<p>First, let’s define the interfaces of max-heap in the header file as follows:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// maxheap.h file</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> _MAXHEAP_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _MAXHEAP_H</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">int</span> key_type;</span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">maxheap</span> *<span class="title">maxheap</span>;</span> <span class="comment">// opaque type</span></span><br><span class="line"></span><br><span class="line">maxheap <span class="title function_">maxheap_create</span><span class="params">()</span>;</span><br><span class="line">maxheap <span class="title function_">maxheap_heapify</span><span class="params">(<span class="type">const</span> key_type *<span class="built_in">array</span>, <span class="type">int</span> n)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">maxheap_destroy</span><span class="params">(maxheap)</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">maxheap_findmax</span><span class="params">(maxheap)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">maxheap_insert</span><span class="params">(maxheap, key_type)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">maxheap_deletemax</span><span class="params">(maxheap)</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">maxheap_is_empty</span><span class="params">(maxheap)</span>;</span><br><span class="line"><span class="type">int</span> <span class="title function_">maxheap_size</span><span class="params">(maxheap)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">maxheap_clear</span><span class="params">(maxheap)</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure>

<p>We define the max-heap as <code>struct _maxheap</code> and hide its implementation in the header file. And expose this struct in the interfaces via a handler(which is a pointer) <code>maxheap</code>. This technique in C program is called <a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/2301454/what-defines-an-opaque-type-in-c-and-when-are-they-necessary-and-or-useful"><code>opaque type</code></a>. <code>Opaque type</code> simulates the encapsulation concept of OOP programming. So that the internal details of a type can change without the code that uses it having to change. The detailed implementation goes as following:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// maxheap.c file</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> _<span class="title">maxheap</span> &#123;</span></span><br><span class="line">	key_type* <span class="built_in">array</span>;</span><br><span class="line">	<span class="type">int</span> max_size;</span><br><span class="line">	<span class="type">int</span> cur_size;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>The max-heap elements are stored inside the <code>array</code> field. The capacity of the array is defined as field <code>max_size</code> and the current number of elements in the array is <code>cur_size</code>. </p>
<p>Next, let’s go through the interfaces one by one (most of the interfaces are straightforward, so I will not explain too much about them). The first one is <code>maxheap_create</code>, which constructs an instance of <code>maxheap</code> by allocating memory for it. </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// maxheap.c file</span></span><br><span class="line">maxheap <span class="title function_">maxheap_create</span><span class="params">()</span> &#123;</span><br><span class="line">	maxheap h = (maxheap)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> _maxheap));</span><br><span class="line">	<span class="keyword">if</span> (h == <span class="literal">NULL</span>) &#123;</span><br><span class="line">		<span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;Not enough memory!\n&quot;</span>);</span><br><span class="line">		<span class="built_in">abort</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	h-&gt;max_size = <span class="number">64</span>;</span><br><span class="line">	h-&gt;cur_size = <span class="number">-1</span>;</span><br><span class="line">	h-&gt;<span class="built_in">array</span> = (key_type*) <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(key_type)*(h-&gt;max_size));</span><br><span class="line">	<span class="keyword">if</span> (h-&gt;<span class="built_in">array</span> == <span class="literal">NULL</span>) &#123;</span><br><span class="line">		<span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;Not enough memory!\n&quot;</span>);</span><br><span class="line">		<span class="built_in">abort</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> h;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The initial capacity of the max-heap is set to 64, we can dynamically enlarge the capacity when more elements need to be inserted into the heap: </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// maxheap.c file</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">maxheap_double_capacity</span><span class="params">(maxheap h)</span> &#123;</span><br><span class="line">	<span class="type">int</span> new_max_size = <span class="number">2</span> * h-&gt;max_size;</span><br><span class="line">	key_type* new_array = (key_type*) <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(key_type)* (new_max_size));</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (new_array == <span class="literal">NULL</span>) &#123;</span><br><span class="line">		<span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;Not enough memory!\n&quot;</span>);</span><br><span class="line">		<span class="built_in">abort</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; h-&gt;cur_size; i++) &#123;</span><br><span class="line">		new_array[i] = h-&gt;<span class="built_in">array</span>[i];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">free</span>(h-&gt;<span class="built_in">array</span>);</span><br><span class="line">	h-&gt;<span class="built_in">array</span> = new_array;</span><br><span class="line">	h-&gt;max_size = new_max_size;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>This is an internal API, so we define it as a <a target="_blank" rel="noopener" href="https://www.tutorialspoint.com/static-functions-in-c"><code>static</code></a> function, which limits the access scope to its object file. </p>
<p>When the program doesn’t use the max-heap data anymore, we can destroy it as follows:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// maxheap.c file</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">maxheap_destroy</span><span class="params">(maxheap h)</span> &#123;</span><br><span class="line">	assert(h);</span><br><span class="line">	<span class="built_in">free</span>(h-&gt;<span class="built_in">array</span>);</span><br><span class="line">	<span class="built_in">free</span>(h);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Don’t forget to release the allocated memory by calling <code>free</code>. </p>
<p>Next, let’s work on the difficult but interesting part: insert an element in <strong>O(log N)</strong> time. The solution goes as follows:</p>
<ul>
<li>Add the element to the end of the array. (The end of the array corresponds to the leftmost open space of the bottom level of the tree).</li>
<li>Compare the added element with its parent; if they are in the correct order(parent should be greater or equal to the child in max-heap, right?), stop.</li>
<li>If not, swap the element with its parent and return to the above step until reaches the top of the tree(the top of the tree corresponds to the first element in the array). </li>
</ul>
<p>The first step of adding an element to the array’s end conforms to the <strong>shape property</strong> first. Then the <strong>heap property</strong> is restored by traversing up the heap. The recursive traversing up and swapping process is called <code>heapify-up</code>. It is can be illustrated by the following pseudo-code:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Max-Heapify-Up(A, i):</span><br><span class="line">    parent ← (i - 1) / 2</span><br><span class="line">    </span><br><span class="line">    if parent &gt;= 0 and A[parent] &lt; A[i] then:</span><br><span class="line">        swap A[i] and A[parent]</span><br><span class="line">        Max-Heapify-Up(A, parent)</span><br></pre></td></tr></table></figure>
<p>The implementation goes as follows:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// maxheap.c file</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">maxheap_swap</span><span class="params">(maxheap h, <span class="type">int</span> i, <span class="type">int</span> j)</span> &#123;</span><br><span class="line">	assert(h &amp;&amp; i &gt;=<span class="number">0</span> &amp;&amp; i &lt;= h-&gt;cur_size &amp;&amp; j &gt;= <span class="number">0</span> &amp;&amp; j &lt;= h-&gt;cur_size);</span><br><span class="line">	key_type tmp = h-&gt;<span class="built_in">array</span>[i];</span><br><span class="line">	h-&gt;<span class="built_in">array</span>[i] = h-&gt;<span class="built_in">array</span>[j];</span><br><span class="line">	h-&gt;<span class="built_in">array</span>[j] = tmp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">maxheap_heapifyup</span><span class="params">(maxheap h, <span class="type">int</span> k)</span> &#123;</span><br><span class="line">	assert(h &amp;&amp; k &gt;= <span class="number">0</span> &amp;&amp; k &lt;= h-&gt;cur_size);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span>(k&gt;=<span class="number">0</span> &amp;&amp; h-&gt;<span class="built_in">array</span>[k] &gt; h-&gt;<span class="built_in">array</span>[k/<span class="number">2</span>]) &#123;</span><br><span class="line">		maxheap_swap(h, k/<span class="number">2</span>, k);</span><br><span class="line">		k /= <span class="number">2</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">maxheap_insert</span><span class="params">(maxheap h, key_type key)</span> &#123;</span><br><span class="line">	assert(h);</span><br><span class="line"></span><br><span class="line">	h-&gt;cur_size += <span class="number">1</span>;</span><br><span class="line">	<span class="comment">// make sure there is space</span></span><br><span class="line">	<span class="keyword">if</span> (h-&gt;cur_size == h-&gt;max_size) &#123;</span><br><span class="line">		maxheap_double_capacity(h);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// add at the end</span></span><br><span class="line">	h-&gt;<span class="built_in">array</span>[h-&gt;cur_size] = key;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// restore the heap property by heapify-up</span></span><br><span class="line">	maxheap_heapifyup(h, h-&gt;cur_size);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The number of operations requried in <code>heapify-up</code> depends on how many levels the new element must rise to satisfy the heap property. So the worst-case time complexity should be the height of the binary heap, which is <strong>log N</strong>. And appending a new element to the end of the array can be done with constant time by using <code>cur_size</code> as the index. As a result, the total time complexity of the insert operation should be <strong>O(log N)</strong>. </p>
<p>Similarly, next, let’s work on: extract the root from the heap while retaining the heap property in <strong>O(log N)</strong> time. The solution goes as follows:</p>
<ul>
<li>Replace the first element of the array with the element at the end. Then delete the last element. </li>
<li>Compare the new root with its children; if they are in the correct order, stop.</li>
<li>If not, swap the element with its child and repeat the above step.</li>
</ul>
<p>This similar traversing down and swapping process is called <code>heapify-down</code>. <code>heapify-down</code> is a little more complex than <code>heapify-up</code> since the parent element needs to swap with the <em>larger</em> children in the max heap. The implementation goes as follows: </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// maxheap.c file</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">maxheap_is_empty</span><span class="params">(maxheap h)</span> &#123;</span><br><span class="line">	assert(h);</span><br><span class="line">	<span class="keyword">return</span> h-&gt;cur_size &lt; <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">maxheap_heapifydown</span><span class="params">(maxheap h, <span class="type">int</span> k)</span> &#123;</span><br><span class="line">	assert(h);</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">while</span>(<span class="number">2</span>*k &lt;= h-&gt;cur_size) &#123;</span><br><span class="line">		<span class="type">int</span> j = <span class="number">2</span>*k;</span><br><span class="line">		<span class="keyword">if</span> (j&lt;h-&gt;cur_size &amp;&amp; h-&gt;<span class="built_in">array</span>[j+<span class="number">1</span>] &gt; h-&gt;<span class="built_in">array</span>[j]) &#123;</span><br><span class="line">			j++;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (h-&gt;<span class="built_in">array</span>[k] &gt;= h-&gt;<span class="built_in">array</span>[j]) &#123;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		maxheap_swap(h, k, j);</span><br><span class="line">		k = j;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">maxheap_findmax</span><span class="params">(maxheap h)</span> &#123;</span><br><span class="line">	<span class="keyword">if</span> (maxheap_is_empty(h)) &#123;</span><br><span class="line">		<span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;Heap is empty!\n&quot;</span>);</span><br><span class="line">		<span class="built_in">abort</span>();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// max is the first position</span></span><br><span class="line">	<span class="keyword">return</span> h-&gt;<span class="built_in">array</span>[<span class="number">0</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">maxheap_deletemax</span><span class="params">(maxheap h)</span> &#123;</span><br><span class="line">	<span class="keyword">if</span> (maxheap_is_empty(h)) &#123;</span><br><span class="line">		<span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;Heap is empty!\n&quot;</span>);</span><br><span class="line">		<span class="built_in">abort</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// swap the first and last element</span></span><br><span class="line">	maxheap_swap(h, <span class="number">0</span>, h-&gt;cur_size);</span><br><span class="line">	h-&gt;cur_size -= <span class="number">1</span>;</span><br><span class="line">	</span><br><span class="line">	maxheap_heapifydown(h, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Based on the analysis of <code>heapify-up</code>, similarly, the time complexity of extract is also <strong>O(log n)</strong>.</p>
<p>In the next section, let’s go back to the question raised at the beginning of this article. </p>
<h3 id="The-time-complexity-of-building-a-heap"><a href="#The-time-complexity-of-building-a-heap" class="headerlink" title="The time complexity of building a heap"></a>The time complexity of building a heap</h3><p>What’s the time complexity of building a heap? The first answer that comes to my mind is <strong>O(n log n)</strong>. Since the time complexity to insert an element is <em>O(log n)</em>, for n elements the insert is repeated n times, so the time complexity is <em>O(n log n)</em>. Right?</p>
<p>We can use another optimal solution to build a heap instead of inserting each element repeatedly. It goes as follows:</p>
<ul>
<li>Arbitrarily putting the n elements into the array to respect the <strong>shape property</strong>.</li>
<li>Starting from the lowest level and moving upwards, sift the root of each subtree downward as in the <code>heapify-down</code> process until the <strong>heap property</strong> is restored. </li>
</ul>
<p>This process can be illustrated with the following image:</p>
<img src="/images/build-heap.png" title="heap" width="400px" height="300px">

<p>This algorithm can be implemented as follows: </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">maxheap <span class="title function_">maxheap_heapify</span><span class="params">(<span class="type">const</span> key_type* <span class="built_in">array</span>, <span class="type">int</span> n)</span> &#123;</span><br><span class="line">	assert(<span class="built_in">array</span> &amp;&amp; n &gt; <span class="number">0</span>);</span><br><span class="line">	</span><br><span class="line">	maxheap h = (maxheap)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> _maxheap));</span><br><span class="line">	<span class="keyword">if</span>(h == <span class="literal">NULL</span>) &#123;</span><br><span class="line">		<span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;Not enough memory!\n&quot;</span>);</span><br><span class="line">		<span class="built_in">abort</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	h-&gt;max_size = n;</span><br><span class="line">	h-&gt;cur_size = <span class="number">-1</span>;</span><br><span class="line">	h-&gt;<span class="built_in">array</span> = (key_type*)(<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(key_type)*h-&gt;max_size));</span><br><span class="line">	<span class="keyword">if</span>(h-&gt;<span class="built_in">array</span> == <span class="literal">NULL</span>) &#123;</span><br><span class="line">		<span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;Not enough memory!\n&quot;</span>);</span><br><span class="line">		<span class="built_in">abort</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	h-&gt;cur_size = n<span class="number">-1</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>; i&lt; n; i++) &#123;</span><br><span class="line">		h-&gt;<span class="built_in">array</span>[i] = <span class="built_in">array</span>[i];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// small trick here. don&#x27;t need start the loop from the end</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = h-&gt;max_size/<span class="number">2</span>; i &gt;= <span class="number">0</span>; i--) &#123; </span><br><span class="line">		maxheap_heapifydown(h, i);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> h;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Next, let’s analyze the time complexity of this above process. Suppose there are <em>n</em> elements in the heap, and the height of the heap is <em>h</em> (for the heap in the above image, the height is 3). Then we should have the following relationship: </p>
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mi>h</mi></msup><mo>&lt;</mo><mo>=</mo><mi>n</mi><mo>&lt;</mo><mo>=</mo><msup><mn>2</mn><mrow><mi>h</mi><mo>+</mo><mn>1</mn></mrow></msup><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">2^{h} &lt;= n &lt;= 2^{h+1} - 1 </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.888208em;vertical-align:-0.0391em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.849108em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">h</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&lt;</span></span><span class="base"><span class="strut" style="height:0.36687em;vertical-align:0em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&lt;</span></span><span class="base"><span class="strut" style="height:0.36687em;vertical-align:0em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.9324379999999999em;vertical-align:-0.08333em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8491079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">h</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>

<p>When there is only one node in the last level then <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>=</mo><msup><mn>2</mn><mi>h</mi></msup></mrow><annotation encoding="application/x-tex">n = 2^{h} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.849108em;vertical-align:0em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.849108em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">h</span></span></span></span></span></span></span></span></span></span></span></span>. And when the last level of the tree is fully filled then <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>=</mo><msup><mn>2</mn><mrow><mi>h</mi><mo>+</mo><mn>1</mn></mrow></msup><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">n = 2^{h+1} - 1 </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.9324379999999999em;vertical-align:-0.08333em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8491079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">h</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span></p>
<p>And start from the bottom as level <em>0</em> (the root node is level <em>h</em>), in level <em>j</em>, there are at most <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mrow><mi>h</mi><mo>−</mo><mi>j</mi></mrow></msup></mrow><annotation encoding="application/x-tex">2^{h-j} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8491079999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8491079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">h</span><span class="mbin mtight">−</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span></span></span></span></span></span></span></span> nodes. And each node at most takes <em>j</em> times swap operation. So in level <em>i</em>, the total number of operation is <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi><mo>∗</mo><msup><mn>2</mn><mrow><mi>h</mi><mo>−</mo><mi>j</mi></mrow></msup></mrow><annotation encoding="application/x-tex">j*2^{h-j} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.85396em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.8491079999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8491079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">h</span><span class="mbin mtight">−</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span></span></span></span></span></span></span></span>.</p>
<p>So the total running time for building the heap is proportional to:</p>
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo><mo>=</mo><mstyle scriptlevel="0" displaystyle="true"><munderover><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>0</mn></mrow><mi>h</mi></munderover><mrow><mi>j</mi><mo>∗</mo><msup><mn>2</mn><mrow><mi>h</mi><mo>−</mo><mi>j</mi></mrow></msup></mrow><mo>=</mo><mstyle scriptlevel="0" displaystyle="true"><munderover><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>0</mn></mrow><mi>h</mi></munderover><mrow><mi>j</mi><mo>∗</mo><mfrac><msup><mn>2</mn><mi>h</mi></msup><msup><mn>2</mn><mi>j</mi></msup></mfrac></mrow></mstyle></mstyle></mrow><annotation encoding="application/x-tex"> 
T(n) = \displaystyle\sum_{j=0}^h {j*2^{h-j}} = \displaystyle\sum_{j=0}^h {j* \frac {2^{h}} {2^{j}}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.2498900000000006em;vertical-align:-1.4137769999999998em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8361130000000006em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mtight">0</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">h</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.4137769999999998em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8991079999999999em;"><span style="top:-3.1130000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">h</span><span class="mbin mtight">−</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.2498900000000006em;vertical-align:-1.4137769999999998em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8361130000000006em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mtight">0</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">h</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.4137769999999998em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.526108em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.750664em;"><span style="top:-2.9890000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.849108em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">h</span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span>

<p>If we factor out the <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mi>h</mi></msup></mrow><annotation encoding="application/x-tex">2^{h} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.849108em;vertical-align:0em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.849108em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">h</span></span></span></span></span></span></span></span></span></span></span></span> term, then we get:</p>
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo><mo>=</mo><msup><mn>2</mn><mi>h</mi></msup><mstyle scriptlevel="0" displaystyle="true"><munderover><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>0</mn></mrow><mi>h</mi></munderover><mfrac><mi>j</mi><msup><mn>2</mn><mi>j</mi></msup></mfrac></mstyle></mrow><annotation encoding="application/x-tex"> 
T(n) = 2^{h} \displaystyle\sum_{j=0}^h {\frac {j} {2^{j}}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.2498900000000006em;vertical-align:-1.4137769999999998em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.849108em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">h</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8361130000000006em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mtight">0</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">h</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.4137769999999998em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3365200000000002em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.750664em;"><span style="top:-2.9890000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span>

<p>As we know, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle scriptlevel="0" displaystyle="true"><munderover><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>0</mn></mrow><mi mathvariant="normal">∞</mi></munderover><mfrac><mi>j</mi><msup><mn>2</mn><mi>j</mi></msup></mfrac></mstyle></mrow><annotation encoding="application/x-tex">\displaystyle\sum_{j=0}^{\infin} {\frac {j} {2^{j}}} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3.0651740000000007em;vertical-align:-1.4137769999999998em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6513970000000007em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mtight">0</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">∞</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.4137769999999998em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3365200000000002em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.750664em;"><span style="top:-2.9890000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span> is a series converges to 2 (in detail, you can refer to this <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Series_(mathematics)">wiki</a>).  </p>
<p>Using this we have:</p>
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo><mo>=</mo><msup><mn>2</mn><mi>h</mi></msup><mstyle scriptlevel="0" displaystyle="true"><munderover><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>0</mn></mrow><mi>h</mi></munderover><mfrac><mi>j</mi><msup><mn>2</mn><mi>j</mi></msup></mfrac><mo>&lt;</mo><mo>=</mo><msup><mn>2</mn><mi>h</mi></msup><mstyle scriptlevel="0" displaystyle="true"><munderover><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>0</mn></mrow><mi mathvariant="normal">∞</mi></munderover><mfrac><mi>j</mi><msup><mn>2</mn><mi>j</mi></msup></mfrac><mo>&lt;</mo><mo>=</mo><msup><mn>2</mn><mi>h</mi></msup><mo>∗</mo><mn>2</mn><mo>=</mo><msup><mn>2</mn><mrow><mi>h</mi><mo>+</mo><mn>1</mn></mrow></msup></mstyle></mstyle></mrow><annotation encoding="application/x-tex"> 
T(n) = 2^{h} \displaystyle\sum_{j=0}^h {\frac {j} {2^{j}}} &lt;= 2^{h} \displaystyle\sum_{j=0}^{\infin} {\frac {j} {2^{j}}} &lt;= 2^{h}*2 = 2^{h + 1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.2498900000000006em;vertical-align:-1.4137769999999998em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.849108em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">h</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8361130000000006em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mtight">0</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">h</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.4137769999999998em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3365200000000002em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.750664em;"><span style="top:-2.9890000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&lt;</span></span><span class="base"><span class="strut" style="height:0.36687em;vertical-align:0em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.0651740000000007em;vertical-align:-1.4137769999999998em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8991079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">h</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6513970000000007em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mtight">0</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">∞</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.4137769999999998em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3365200000000002em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.750664em;"><span style="top:-2.9890000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&lt;</span></span><span class="base"><span class="strut" style="height:0.36687em;vertical-align:0em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8991079999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8991079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">h</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8991079999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8991079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">h</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span></span></span>

<p>Based on the condition <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mi>h</mi></msup><mo>&lt;</mo><mo>=</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">2^{h} &lt;= n </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.888208em;vertical-align:-0.0391em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.849108em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">h</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&lt;</span></span><span class="base"><span class="strut" style="height:0.36687em;vertical-align:0em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">n</span></span></span></span>, so we have:</p>
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo><mo>&lt;</mo><mo>=</mo><mn>2</mn><mi>n</mi><mo>=</mo><mi>O</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex"> 
T(n) &lt;= 2n = O(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&lt;</span></span><span class="base"><span class="strut" style="height:0.36687em;vertical-align:0em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">2</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span>

<p>Now we prove that building a heap is a linear operation.</p>
<h3 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h3><p>In this article, we examined what is a <code>Heap</code> and understand how it behaves(<code>heapify-up</code> and <code>heapify-down</code>) by implementing it. More importantly, we analyze the time complexity of building a heap and prove it’s a linear operation.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://baoqger.github.io/2018/10/08/why-build-heap-is-a-linear-operation/" data-id="cl4e085lj002iq8mm85an41q2" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/priority-queue-data-structure-algorithm-time-complexity-Big-O-notation/" rel="tag">priority queue, data structure, algorithm, time complexity, Big O notation</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/5/">&amp;laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><a class="page-number" href="/page/5/">5</a><span class="page-number current">6</span>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/BPF-JIT-virtual-machine/" rel="tag">BPF, JIT, virtual machine</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Best-practice/" rel="tag">Best practice,</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Fabio-Golang-Source-code/" rel="tag">Fabio, Golang, Source code</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Golang-bufio-bytes-buffer/" rel="tag">Golang, bufio, bytes, buffer</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Golang-package-workspace-vendor/" rel="tag">Golang, package, workspace, vendor</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTTP-protocol-Golang-TCP-socket/" rel="tag">HTTP protocol, Golang, TCP, socket</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTTP-system-call-Linux-Golang/" rel="tag">HTTP, system call, Linux, Golang</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTTP-1-1-concurrent/" rel="tag">HTTP/1.1, concurrent</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTTP-1-1-persistent-connection-keep-alive-TCP-netstat-tcpdump-Golang-connection-pool/" rel="tag">HTTP/1.1, persistent connection, keep-alive, TCP, netstat, tcpdump, Golang, connection pool</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTTPS-TLS-handshake-SSL-TLS/" rel="tag">HTTPS, TLS handshake, SSL/TLS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux-module-Netfilter-firewall/" rel="tag">Linux module, Netfilter, firewall</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux-system-programming-Windows-Subsystem-for-Linux/" rel="tag">Linux, system programming, Windows Subsystem for Linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TCP-IP/" rel="tag">TCP, IP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/apt-Ubuntu-Linux-package-management/" rel="tag">apt, Ubuntu, Linux, package management</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/certificate-digital-signature-hashing/" rel="tag">certificate, digital signature, hashing</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/digital-signature-hash-function/" rel="tag">digital signature, hash function</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker-c-linux/" rel="tag">docker, c++, linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/golang-concurrent-shared-memory-message-pass/" rel="tag">golang, concurrent, shared memory, message pass</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/memory-management-stack/" rel="tag">memory management, stack</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/microservice-Load-balancing-Consul-Fabio-Golang-Cloud-Native-Docker/" rel="tag">microservice, Load balancing, Consul, Fabio Golang, Cloud-Native, Docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/microservice-service-registration-service-discovery-Consul-Golang-Cloud-Native-Docker/" rel="tag">microservice, service registration, service discovery, Consul, Golang, Cloud-Native, Docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/operating-system-xv6-Unix/" rel="tag">operating system, xv6, Unix</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/packet-sniffer-socket-PF-PACKET/" rel="tag">packet sniffer, socket, PF_PACKET</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/priority-queue-data-structure-algorithm-time-complexity-Big-O-notation/" rel="tag">priority queue, data structure, algorithm, time complexity, Big O notation</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/programming-c-array-pointer/" rel="tag">programming c, array, pointer</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/public-key-man-in-the-middle-certificate/" rel="tag">public key, man-in-the-middle, certificate</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/BPF-JIT-virtual-machine/" style="font-size: 10px;">BPF, JIT, virtual machine</a> <a href="/tags/Best-practice/" style="font-size: 10px;">Best practice,</a> <a href="/tags/Fabio-Golang-Source-code/" style="font-size: 10px;">Fabio, Golang, Source code</a> <a href="/tags/Golang-bufio-bytes-buffer/" style="font-size: 10px;">Golang, bufio, bytes, buffer</a> <a href="/tags/Golang-package-workspace-vendor/" style="font-size: 10px;">Golang, package, workspace, vendor</a> <a href="/tags/HTTP-protocol-Golang-TCP-socket/" style="font-size: 10px;">HTTP protocol, Golang, TCP, socket</a> <a href="/tags/HTTP-system-call-Linux-Golang/" style="font-size: 10px;">HTTP, system call, Linux, Golang</a> <a href="/tags/HTTP-1-1-concurrent/" style="font-size: 10px;">HTTP/1.1, concurrent</a> <a href="/tags/HTTP-1-1-persistent-connection-keep-alive-TCP-netstat-tcpdump-Golang-connection-pool/" style="font-size: 10px;">HTTP/1.1, persistent connection, keep-alive, TCP, netstat, tcpdump, Golang, connection pool</a> <a href="/tags/HTTPS-TLS-handshake-SSL-TLS/" style="font-size: 10px;">HTTPS, TLS handshake, SSL/TLS</a> <a href="/tags/Linux-module-Netfilter-firewall/" style="font-size: 20px;">Linux module, Netfilter, firewall</a> <a href="/tags/Linux-system-programming-Windows-Subsystem-for-Linux/" style="font-size: 10px;">Linux, system programming, Windows Subsystem for Linux</a> <a href="/tags/TCP-IP/" style="font-size: 10px;">TCP, IP</a> <a href="/tags/apt-Ubuntu-Linux-package-management/" style="font-size: 10px;">apt, Ubuntu, Linux, package management</a> <a href="/tags/certificate-digital-signature-hashing/" style="font-size: 10px;">certificate, digital signature, hashing</a> <a href="/tags/digital-signature-hash-function/" style="font-size: 15px;">digital signature, hash function</a> <a href="/tags/docker-c-linux/" style="font-size: 10px;">docker, c++, linux</a> <a href="/tags/golang-concurrent-shared-memory-message-pass/" style="font-size: 10px;">golang, concurrent, shared memory, message pass</a> <a href="/tags/memory-management-stack/" style="font-size: 10px;">memory management, stack</a> <a href="/tags/microservice-Load-balancing-Consul-Fabio-Golang-Cloud-Native-Docker/" style="font-size: 10px;">microservice, Load balancing, Consul, Fabio Golang, Cloud-Native, Docker</a> <a href="/tags/microservice-service-registration-service-discovery-Consul-Golang-Cloud-Native-Docker/" style="font-size: 10px;">microservice, service registration, service discovery, Consul, Golang, Cloud-Native, Docker</a> <a href="/tags/operating-system-xv6-Unix/" style="font-size: 10px;">operating system, xv6, Unix</a> <a href="/tags/packet-sniffer-socket-PF-PACKET/" style="font-size: 10px;">packet sniffer, socket, PF_PACKET</a> <a href="/tags/priority-queue-data-structure-algorithm-time-complexity-Big-O-notation/" style="font-size: 10px;">priority queue, data structure, algorithm, time complexity, Big O notation</a> <a href="/tags/programming-c-array-pointer/" style="font-size: 10px;">programming c, array, pointer</a> <a href="/tags/public-key-man-in-the-middle-certificate/" style="font-size: 10px;">public key, man-in-the-middle, certificate</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/06/">June 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/05/">May 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/03/">March 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/02/">February 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/01/">January 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/12/">December 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">October 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">August 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/07/">July 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/06/">June 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">May 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">April 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">March 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">February 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">September 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">September 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">February 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2022/06/08/how-to-write-a-netfilter-firewall-part3/">how-to-write-a-netfilter-firewall-part3</a>
          </li>
        
          <li>
            <a href="/2022/05/05/how-to-write-a-netfilter-firewall-part2/">Write a Linux firewall from scratch based on Netfilter: part two- hello world module</a>
          </li>
        
          <li>
            <a href="/2022/05/04/how-to-write-a-netfilter-firewall-part1/">Write a Linux firewall from scratch based on Netfilter: part one- Netfilter and Kernel Modules</a>
          </li>
        
          <li>
            <a href="/2022/03/28/how-to-implement-libpcap-on-linux-with-raw-socket-part2/">Write a Linux packet sniffer from scratch: part two- BPF</a>
          </li>
        
          <li>
            <a href="/2022/02/22/how-to-implement-libpcap-on-linux-with-raw-socket-part1/">Write a Linux packet sniffer from scratch: part one- PF_PACKET socket and promiscuous mode</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2022 Chris Bao<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>